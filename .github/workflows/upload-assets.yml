---
# https://github.com/google-github-actions/release-please-action#release-types-supported

on: # yamllint disable-line rule:truthy
  push:
    tags:
      - 'v*.*.*'

name: 📤 Upload artifacts

jobs:
  upload-artifacts:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: true
      matrix:
        os: ['ubuntu-22.04']
        node: ['18']

    steps:
      - name: 📦 Check out the codebase
        uses: actions/checkout@3df4ab11eba7bda6032a0b82a6bb43b11571feac # v4

      - name: ⚙️ Setup node ${{ matrix.node }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node }}
          registry-url: 'https://registry.npmjs.org/'

      - name: 📥 Monorepo install
        uses: ./.github/actions/pnpm-install

      - name: ♻️ Restore packages cache
        uses: actions/cache@v3
        with:
          path: |
            ${{ github.workspace }}/.cache
            ${{ github.workspace }}/**/tsconfig.tsbuildinfo
          key: ${{ runner.os }}-packages-cache-${{ hashFiles('**/pnpm*.yaml') }}
          restore-keys: |
            ${{ runner.os }}-packages-cache-${{ hashFiles('**/pnpm*.yaml') }}

      - name: 🚀 Generate dist files
        run: pnpm build:jar

      - name: 📤 Upload release assets
        uses: alexellis/upload-assets@0.4.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          asset_paths: '["./out/keywind.jar"]'
